<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <style>
      body {
        margin: 4;
      }
      .input_number {
        display: inline-block;
        width: 70px;
        padding: 0.5em;
        border: 1px solid #999;
      }
      .select {
        width: 100px;
      }
    </style>
    <script>
      //
      // 9 permutation 4 同一数値なしの順列算出(3024個)
      //
      const permutation = (nums, k) => {
        let ans = [];
        if (nums.length < k) {
          return [];
        }
        if (k === 1) {
          for (let i = 0; i < nums.length; i++) {
            ans[i] = [nums[i]];
          }
        } else {
          for (let i = 0; i < nums.length; i++) {
            let parts = nums.slice(0);
            parts.splice(i, 1)[0];
            let row = permutation(parts, k - 1);
            for (let j = 0; j < row.length; j++) {
              ans.push([nums[i]].concat(row[j]));
            }
          }
        }
        return ans;
      };

      var all_array = permutation([1, 2, 3, 4, 5, 6, 7, 8, 9], 4);
      //console.log(all_array);
      function create_option() {
        let arr = [" ", "１", "２", "３", "４", "５", "６", "７", "８", "９"];
        let sl = document.getElementById("select1");
        for (let num in arr) {
          let op = document.createElement("option");
          op.text = arr[num];
          sl.appendChild(op);
        }
      }
      //
      // 画面起動時
      //
      window.onload = function () {
        create_option();
      };
      function check_hit(inp_num, ans_num) {
        let hit = 0;
        for (let i = 0; i < 4; i++) {
          console.log(inp_num[i] + " " + ans_num[i]);
          if (inp_num[i] == ans_num[i]) {
            hit++;
          }
        }
        return hit;
      }
      //
      // Hit and Blow
      //
      function hit_and_blow(inum) {
        for (const tnum of all_array) {
          let hit = check_hit(inum, tnum);
          let blow = 0;
          console.log("hit " + hit);

          // } else {
          //   for (let j = 0; j < 4; j++) {
          //     if (i != j) if (inum[i] == tnum[j]) blow++;
          //   }
          // }

          result_text = hit + " hit " + blow + " blow";
          console.log("result " + result_text);
          let sl = document.getElementById("result");
          let opt = document.createElement("option");
          opt.text = result_text;
          sl.appendChild(opt);
          break;
        }
      }
      //
      // 検証
      //
      function onClick() {
        input_number = document.getElementById("in_num");
        hit_and_blow(input_number.value);
      }
    </script>
  </head>
  <body>
    <!-- <!DOCTYPE html> -->
    <html>
      <head>
        <meta charset="utf-8" />
        <title>Hit And Blow ver 0.01</title>
      </head>
      <body>
        <h4>Hit And Blow</h4>
        <div>
          <input
            class="input_number"
            type="text"
            id="in_num"
            oninput="value = value.replace(/[０-９]/g, s => 
              String.fromCharCode(s.charCodeAt(0) - 65248)).replace(/\D/g,'');"
          />
          <button type="button" onclick="onClick()">検証</button>
          <select id="select1"></select>
          <select id="select2"></select>
          <select id="select3"></select>
          <select id="select4"></select>
        </div>
        <div>
          <select id="result" class="select"></select>
        </div>
      </body>
    </html>
  </body>
</html>
